apk <- function(k, actual, predicted){    score <- 0.0    cnt <- 0.0	if (length(actual)==0 && length(predicted)>0)		return(0)	else if (length(actual)==0 && length(predicted)==0)		return(1)    for (i in 1:min(k,length(predicted)))    {        if (predicted[i] %in% actual && !(predicted[i] %in% predicted[0:(i-1)]))        {            cnt <- cnt + 1            score <- score + cnt/i        }    }    score <- score / min(length(actual), k)    score}mapk <- function (k, actual, predicted){    scores <- rep(0, length(actual))	    for (i in 1:length(scores))    {        scores[i] <- apk(k, actual[[i]], predicted[[i]])    }    score <- mean(scores)    score}getSubList=function(x,train=F,output=F){	ind=order(x[,1],x[,3],decreasing=T)	x=x[ind,]	aid=unique(x[,1])	tb=rev(table(x[,1]))	n=length(tb)	stb=cumsum(tb)	indi=c(1,stb[1:(n-1)]+1)	indj=stb	if (train)	{		indz=x[,3]>0		m=length(indz)		b=apply(cbind(indi,indj),1,function(a,x){													y=x[a[1]:a[2],2]													d=which(indz[a[1]:a[2]])													return(y[d])												},x)	}	else		b=apply(cbind(indi,indj),1,function(a,x) return(x[a[1]:a[2],2]),x)	if (output)	{		ans=apply(b,2,paste,collapse=" ")		ans=data.frame(authorid=aid,paperids=ans)		if (typeof(b)=="double")			ans[,2]=as.character(ans[,2])		return(ans)	}	if (typeof(b)=="double")	{		ans=list()		n=ncol(b)		for (i in 1:n)			ans[[i]]=b[,i]		return(ans)	}	return(b)}getMapk=function(k,x)#variables of x should be in this order: authorid, paperid, real value (0-1), predicted probability{	act=getSubList(x[,1:3],train=T)	pred=getSubList(x[,c(1,2,4)])	ans=mapk(k,act,pred)	return(ans)}getVars=function(n,m){	hm=m%/%2	ans=list()	ans[[1]]=1:m	j=2	i=1	while (j<=n)	{		ii=hm+i%%hm		ans[[j]]=sample(1:m,ii)		j=j+1		i=i+1	}	return(ans)}getParaInd=function(n,m){	ans=NULL	while(n>m)	{		ans=c(ans,sample(1:m,m))		n=n-m	}	if (n>0)		ans=c(ans,sample(1:m,n))	return(ans)}